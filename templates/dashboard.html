<!DOCTYPE html>
<html>
<head>
  <title>Second Brain ‚Äì Timeline</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="/static/css/dark.css">
  <style>
    body { background: #181b28; color: #d3e3fc; font-family: 'Inter', Arial, sans-serif;}
    .timeline { margin: 2em auto; max-width: 820px; }
    .day-group { margin-bottom: 2em; }
    .day-label { color: #81aaff; font-size: 1.22em; margin-bottom: 0.5em; border-left: 4px solid #81aaff; padding-left: 13px; font-weight: bold;}
    .note-timeline { display: flex; align-items: flex-start; gap: 1.4em; margin-bottom: 1em; background: #202a3a; border-radius: 10px; padding: 1em 1.4em; box-shadow: 0 1px 10px #0003; transition: background 0.2s; cursor: pointer;}
    .note-timeline:hover { background: #252d43; }
    .bubble-time { background: #232c4e; color: #81aaff; font-size: 1em; padding: 0.6em 1em; border-radius: 50px; font-weight: bold; min-width: 60px; text-align: center; margin-top: 8px;}
    .note-content { flex: 1; }
    .note-title { font-size: 1.08em; font-weight: bold; margin-bottom: 0.16em; color:#83bfff;}
    .note-summary { color: #d1c8ff; margin-bottom: 0.32em; }
    .note-tags { color: #68e3fc; font-size: 0.98em; margin-bottom: 0.2em; }
    .note-type { font-size: 0.94em; color: #ffb47d; }
    a { color: #81aaff; text-decoration: none;}
    a.tag-link { color: #52ebff; background: #181d28; border-radius: 6px; padding: 2px 7px; font-size:0.98em; margin-right:4px;}
    @media (max-width: 600px) {
      .timeline { max-width: 98vw; padding:0 0.4em;}
      .note-timeline { flex-direction: column; gap: 0.7em;}
      .bubble-time { margin-top:0; margin-bottom: 8px;}
    }
  </style>
</head>
<body>
  <!-- Hero/logo and tagline -->
  <div class="max-w-2xl mx-auto mt-8 mb-6 text-center flex flex-col items-center">
    <div class="flex items-center justify-center gap-2 mb-2">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-9 w-9 text-pink-400" viewBox="0 0 24 24" fill="none">
        <rect x="2" y="5" width="20" height="15" rx="6" fill="#81aaff" />
        <path d="M7 8h10M7 12h6M7 16h2" stroke="#fae1e9" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <span class="text-3xl md:text-4xl font-extrabold text-pink-200 tracking-tight">Second Brain</span>
    </div>
    <div class="text-lg text-blue-300 mb-3">Capture anything, anywhere. Summarize, search, and grow your digital memory.</div>
    <div class="flex flex-wrap gap-2 justify-center mb-3">
      <span class="bg-[#202a3a] px-3 py-1 rounded text-blue-200 text-sm border border-blue-600">üìù Quick text capture</span>
      <span class="bg-[#202a3a] px-3 py-1 rounded text-blue-200 text-sm border border-pink-500">üé§ Audio-to-text notes</span>
      <span class="bg-[#202a3a] px-3 py-1 rounded text-blue-200 text-sm border border-yellow-400">‚ú® AI summaries & titles</span>
      <span class="bg-[#202a3a] px-3 py-1 rounded text-blue-200 text-sm border border-green-500">üè∑Ô∏è Smart tags</span>
      <span class="bg-[#202a3a] px-3 py-1 rounded text-blue-200 text-sm border border-purple-500">üîé Fast search</span>
      <span class="bg-[#202a3a] px-3 py-1 rounded text-blue-200 text-sm border border-blue-400">üîÑ Sync to Obsidian</span>
    </div>
    <div class="text-blue-400 text-sm mt-1">
      The fast, modern way to capture and organize your thoughts. <span class="text-pink-300">Everything stays in sync with your notes vault.</span>
    </div>
  </div>

  <!-- Quick Capture Form -->
  <div class="max-w-2xl mx-auto my-8 bg-[#202a3a] rounded-xl shadow-md p-6 flex flex-col gap-3 border border-[#232c4e]">
    <form id="quickCaptureForm" method="post" action="/capture" enctype="multipart/form-data" class="flex flex-col gap-4 md:flex-row md:items-end" autocomplete="off">
      <div class="flex-1">
        <label for="note" class="block text-sm font-medium text-blue-300 mb-1">Quick Capture</label>
        <input
          type="text"
          name="note"
          id="note"
          placeholder="Type a note or thought..."
          class="w-full rounded-lg border border-gray-700 bg-[#232c4e] text-blue-100 px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none placeholder:text-blue-400"
        >
      </div>
      <div>
        <label for="tags" class="block text-sm font-medium text-blue-300 mb-1">Tags</label>
        <input
          type="text"
          name="tags"
          id="tags"
          placeholder="comma,separated"
          class="w-full rounded-lg border border-gray-700 bg-[#232c4e] text-blue-100 px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none placeholder:text-blue-400"
        >
      </div>
      <div>
        <label class="block text-sm font-medium text-blue-300 mb-1">Audio</label>
        <div class="flex items-center gap-2">
          <input
            type="file"
            name="file"
            id="file"
            accept="audio/*"
            class="block text-blue-200 border border-gray-700 rounded-lg bg-[#232c4e] focus:ring-2 focus:ring-blue-500 focus:outline-none"
          >
          <button type="button" id="recordBtn"
            class="bg-pink-500 hover:bg-pink-600 text-white font-bold px-4 py-2 rounded-lg transition"
          >üé§ Record</button>
          <span id="recordStatus" class="text-xs text-pink-300 ml-2"></span>
        </div>
      </div>
      <button
        id="saveBtn"
        type="submit"
        class="mt-4 md:mt-0 bg-blue-500 hover:bg-blue-600 text-white font-bold px-6 py-2 rounded-lg transition"
      >Save</button>
    </form>
    <p class="text-xs text-blue-400 mt-1">
      Capture a quick note or upload an audio file to transcribe & summarize.<br>
      <span class="text-pink-300">Tip:</span> You can tag notes for easier searching!
    </p>
  </div>

  <!-- Tailwindified Search Bar -->
  <div class="max-w-2xl mx-auto mb-4">
    <form method="get" class="flex items-center gap-3">
      <input type="text" name="q" placeholder="Search your notes..." value="{{ q or '' }}"
        class="flex-1 rounded-lg border border-gray-700 bg-[#232c4e] text-blue-100 px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none placeholder:text-blue-400"/>
      <button type="submit"
        class="bg-blue-600 hover:bg-blue-700 text-white font-bold px-4 py-2 rounded-lg transition">Search</button>
      {% if q %}
        <a href="/" class="ml-2 text-pink-300 underline text-sm">Clear search</a>
      {% endif %}
      {% if tag %}
        <span class="ml-2 text-green-300 text-sm">Tag: #{{ tag }}</span>
        <a href="/" class="ml-2 text-yellow-300 underline text-sm">Clear filter</a>
      {% endif %}
    </form>
  </div>

  <!-- Timeline Header -->
  <div class="text-center mb-2">
    <h1 class="text-3xl font-bold text-pink-200 inline-flex items-center gap-2">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-pink-300 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <rect x="3" y="4" width="18" height="18" rx="4" fill="#232c4e"/>
        <path stroke="#fae1e9" stroke-width="2" d="M8 2v4m8-4v4M3 10h18"/>
      </svg>
      Timeline
    </h1>
  </div>

  <div class="timeline">
    {% for day, notes_on_day in notes_by_day.items() %}
      <div class="day-group">
        <div class="day-label">{{ day }}</div>
        {% for note in notes_on_day %}
          <div class="note-timeline" onclick="window.location='/detail/{{ note['id'] }}'">
            <div class="bubble-time">{{ note['timestamp'][11:16] }}</div>
            <div class="note-content">
              <div class="note-title">
                <a href="/detail/{{ note['id'] }}">{{ note['title']|highlight(q) }}</a>
                {% if note['type'] != 'note' %}
                  <span class="note-type">({{ note['type'] }})</span>
                {% endif %}
              </div>
              <div class="note-summary">{{ note['summary']|highlight(q) }}</div>
              <div class="note-tags">
                {% for tag_ in note['tags'].split(',') if tag_.strip() %}
                  <a href="/?tag={{ tag_.strip() }}" class="tag-link">#{{ tag_.strip()|highlight(q) }}</a>
                {% endfor %}
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% endfor %}
    {% if not notes_by_day %}
      <p class="mt-8 text-center text-pink-300 text-lg">No notes found. Try capturing a new thought or search for something else!</p>
    {% endif %}
  </div>
  
  <!-- Audio recording: Auto-submit after recording -->
  <script>
    let mediaRecorder, audioChunks;
    const recordBtn = document.getElementById('recordBtn');
    const recordStatus = document.getElementById('recordStatus');
    const fileInput = document.getElementById('file');
    const form = document.getElementById('quickCaptureForm');
    let recording = false;

    recordBtn.onclick = async function() {
      if (!recording) {
        // Start recording
        if (!navigator.mediaDevices) {
          recordStatus.textContent = "Recording not supported!";
          return;
        }
        recordStatus.textContent = "Recording...";
        audioChunks = [];
        try {
          const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
          mediaRecorder = new MediaRecorder(stream);
          mediaRecorder.start();
          recording = true;
          recordBtn.textContent = "‚ñ† Stop";
          mediaRecorder.ondataavailable = (e) => audioChunks.push(e.data);
          mediaRecorder.onstop = (e) => {
            const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
            const file = new File([audioBlob], "recording.wav", { type: "audio/wav" });
            const dt = new DataTransfer();
            dt.items.add(file);
            fileInput.files = dt.files;
            recordStatus.textContent = "Recorded! Submitting...";
            recordBtn.textContent = "üé§ Record";
            recording = false;
            // Auto-submit the form
            setTimeout(() => {
              form.submit();
              recordStatus.textContent = "Uploading...";
            }, 400); // let DOM update
          };
        } catch (err) {
          recordStatus.textContent = "Mic permission denied.";
        }
      } else {
        // Stop recording
        mediaRecorder.stop();
        recordStatus.textContent = "Processing...";
      }
    };
  </script>
</body>
</html>
