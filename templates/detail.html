<!DOCTYPE html>
<html>
<head>
  <title>{{ note['title']|e }} â€” Second Brain Note</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Tailwind CSS CDN for easy styling -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background: #191c27; color: #e3e6f0; font-family: 'Inter', Arial, sans-serif; }
    .card { background: #232944; border-radius: 18px; box-shadow: 0 2px 12px #0002; }
    .main-content { max-width: 820px; margin: 2.6em auto 0 auto; }
    .note-title { color: #81aaff; font-weight: bold; font-size: 2em; margin-bottom: 0.1em; }
    .note-meta { color: #ffb47d; font-size: 1.02em; margin-bottom: 1em; }
    .section-label { color: #81aaff; font-size: 1.18em; font-weight: 600; margin-bottom: 0.2em; }
    .transcript-box { background: #171d36; color: #7ee9ff; font-family: 'Fira Mono', 'JetBrains Mono', 'Consolas', monospace; padding: 1.2em; border-radius: 10px; margin-bottom: 1.4em; white-space: pre-wrap; font-size: 1.08em;}
    .summary-box { background: #202443; color: #f3eaff; padding: 1em 1.2em; border-radius: 9px; font-size: 1.1em; margin-bottom: 1.2em; line-height: 1.6;}
    .actions-list { margin: 0.3em 0 1em 1em; }
    .actions-list li { margin-bottom: 0.4em; }
    .audio-player { background: #242b3a; border-radius: 16px; padding: 1.2em 1.3em; margin-bottom: 2em; }
    .tags-row { margin-top: 0.6em; }
    .tag-pill { display: inline-block; background: #21294a; color: #68e3fc; border-radius: 8px; padding: 2px 10px; font-size: 0.99em; margin-right: 0.5em; }
    .note-type-label { color: #ffae7d; font-size: 1em; margin-left: 0.2em;}
    a { color: #88d2ff; }
    a.back-link { color: #e9b4fa; font-size: 1.1em; margin-top: 2em; display: inline-block;}
    @media (max-width: 700px) {
      .main-content { max-width: 99vw; margin: 1em 0.5em; }
      .note-title { font-size: 1.3em; }
    }
  </style>
</head>
<body>
  <div class="main-content">
    <!-- Title & Meta -->
    <div class="note-title">{{ note['title']|e }}</div>
    <div class="note-meta">
      {{ note['timestamp'][:19] }} 
      {% if note['type'] %}
        <span class="note-type-label">â€” {{ note['type']|e }}</span>
      {% endif %}
    </div>

    <!-- Tags -->
    <div class="tags-row">
      {% for tag_ in note['tags'].split(',') if tag_.strip() %}
        <span class="tag-pill">#{{ tag_.strip() }}</span>
      {% endfor %}
    </div>

    <!-- Transcript / Note Content -->
    <div class="mt-6">
      <div class="section-label">Transcript / Note Content:</div>
      <div class="transcript-box">{{ note['content']|e }}</div>
    </div>

    <!-- AI Summary Section -->
    <div class="mb-6">
      <div class="section-label">AI Summary:</div>
      <div class="summary-box">
        {{ note['summary']|e }}
      </div>
    </div>

    <!-- Action Items (if any) -->
    {% set actions = [] %}
    {% if note['summary'] and "Action Items:" in note['summary'] %}
      {% set summary_parts = note['summary'].split('Action Items:') %}
      {% if summary_parts|length > 1 %}
        {% set actions = summary_parts[1].strip().split('*') %}
      {% endif %}
    {% endif %}
    {% if actions and actions|length > 1 %}
      <div class="section-label">Action Items:</div>
      <ul class="actions-list">
        {% for action in actions %}
          {% if action.strip() %}
            <li>ðŸŸ¢ {{ action.strip() }}</li>
          {% endif %}
        {% endfor %}
      </ul>
    {% endif %}

    <!-- Audio Playback (if present) -->
    {% if note['audio_filename'] %}
      <div class="audio-player">
        <audio controls style="width:100%;">
          <source src="/audio/{{ note['audio_filename']|e }}" type="audio/wav">
          Your browser does not support the audio element.
        </audio>
      </div>
    {% endif %}

    <a href="/" class="back-link">&larr; Back to Timeline</a>
  </div>
</body>
</html>
