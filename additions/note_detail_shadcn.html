<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Note Detail - Second Brain</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="h-full bg-gray-50" x-data="noteDetail()">
    
    <!-- Header -->
    <header class="bg-white border-b border-gray-200 sticky top-0 z-10">
        <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
            <div class="flex h-16 items-center justify-between">
                <div class="flex items-center gap-4">
                    <a href="/" class="text-gray-400 hover:text-gray-600">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                    </a>
                    <div class="flex items-center gap-3">
                        <div class="flex h-8 w-8 items-center justify-center rounded-lg bg-indigo-600">
                            <span class="text-white font-semibold">üß†</span>
                        </div>
                        <h1 class="text-xl font-semibold text-gray-900">Second Brain</h1>
                    </div>
                </div>
                
                <div class="flex items-center gap-3">
                    <button @click="toggleEdit()" 
                            class="inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50">
                        <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
                        </svg>
                        Edit
                    </button>
                    
                    <div class="relative" x-data="{ open: false }">
                        <button @click="open = !open" class="p-2 text-gray-400 hover:text-gray-600">
                            <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
                            </svg>
                        </button>
                        
                        <div x-show="open" @click.away="open = false" x-transition
                             class="absolute right-0 z-10 mt-2 w-48 rounded-md bg-white py-1 shadow-lg ring-1 ring-black ring-opacity-5">
                            <button @click="exportToObsidian()" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                Export to Obsidian
                            </button>
                            <button @click="shareNote()" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                Share
                            </button>
                            <button @click="deleteNote()" class="block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-gray-100">
                                Delete
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="mx-auto max-w-4xl px-4 sm:px-6 lg:px-8 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
            
            <!-- Main Note -->
            <div class="lg:col-span-3">
                <div class="bg-white rounded-lg border border-gray-200 overflow-hidden">
                    
                    <!-- Note Header -->
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex items-center gap-3">
                                <div :class="note.type === 'audio' ? 'bg-yellow-100 text-yellow-800' : note.type === 'apple' ? 'bg-green-100 text-green-800' : 'bg-blue-100 text-blue-800'"
                                     class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium">
                                    <span x-show="note.type === 'audio'">üéôÔ∏è Audio Note</span>
                                    <span x-show="note.type === 'note'">üìù Text Note</span>
                                    <span x-show="note.type === 'apple'">üì± Apple Shortcut</span>
                                </div>
                                <span x-show="note.status === 'pending'"
                                      class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-gray-100 text-gray-800">
                                    <svg class="animate-spin -ml-1 mr-2 h-4 w-4" fill="none" viewBox="0 0 24 24">
                                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                    </svg>
                                    Processing...
                                </span>
                            </div>
                            <span class="text-sm text-gray-500" x-text="formatDateTime(note.timestamp)"></span>
                        </div>
                        
                        <h1 class="text-3xl font-bold text-gray-900 mb-4" x-text="note.title"></h1>
                        
                        <!-- Tags -->
                        <div x-show="note.tags && note.tags.length > 0" class="flex flex-wrap gap-2">
                            <template x-for="tag in note.tags" :key="tag">
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-indigo-100 text-indigo-800">
                                    #<span x-text="tag"></span>
                                </span>
                            </template>
                        </div>
                    </div>
                    
                    <!-- Audio Player -->
                    <div x-show="note.audioFilename" class="p-6 bg-gray-50 border-b border-gray-200">
                        <div class="flex items-center gap-4">
                            <button @click="toggleAudio()" 
                                    :class="audioPlaying ? 'bg-red-500 hover:bg-red-600' : 'bg-indigo-500 hover:bg-indigo-600'"
                                    class="flex items-center justify-center w-12 h-12 rounded-full text-white shadow-lg">
                                <svg x-show="!audioPlaying" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M8 5v14l11-7z"/>
                                </svg>
                                <svg x-show="audioPlaying" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
                                </svg>
                            </button>
                            <div class="flex-1">
                                <div class="text-sm font-medium text-gray-900 mb-1">Audio Recording</div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="bg-indigo-600 h-2 rounded-full" :style="`width: ${audioProgress}%`"></div>
                                </div>
                            </div>
                            <span class="text-sm text-gray-500" x-text="audioTime"></span>
                        </div>
                    </div>
                    
                    <!-- Summary -->
                    <div x-show="note.summary" class="p-6 border-b border-gray-200">
                        <h2 class="text-lg font-semibold text-gray-900 mb-3">Summary</h2>
                        <p class="text-gray-700 leading-relaxed" x-text="note.summary"></p>
                    </div>
                    
                    <!-- Action Items -->
                    <div x-show="note.actions && note.actions.length > 0" class="p-6 border-b border-gray-200">
                        <h2 class="text-lg font-semibold text-gray-900 mb-3">Action Items</h2>
                        <ul class="space-y-2">
                            <template x-for="(action, index) in note.actions" :key="index">
                                <li class="flex items-start gap-3">
                                    <div class="flex items-center h-6">
                                        <input type="checkbox" 
                                               class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                                    </div>
                                    <span class="text-gray-700" x-text="action"></span>
                                </li>
                            </template>
                        </ul>
                    </div>
                    
                    <!-- Full Content -->
                    <div x-show="showFullContent" class="p-6">
                        <div class="flex items-center justify-between mb-3">
                            <h2 class="text-lg font-semibold text-gray-900">Full Content</h2>
                            <button @click="showFullContent = false" class="text-gray-400 hover:text-gray-600">
                                <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </div>
                        <div class="prose max-w-none">
                            <pre class="whitespace-pre-wrap text-gray-700 text-sm" x-text="note.content"></pre>
                        </div>
                    </div>
                    
                    <!-- Show Full Content Button -->
                    <div x-show="!showFullContent && note.content" class="p-6 text-center border-t border-gray-200">
                        <button @click="showFullContent = true" 
                                class="text-indigo-600 hover:text-indigo-800 font-medium">
                            Show Full Content
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Sidebar -->
            <div class="lg:col-span-1 space-y-6">
                
                <!-- Quick Actions -->
                <div class="bg-white rounded-lg border border-gray-200 p-4">
                    <h3 class="text-sm font-semibold text-gray-900 mb-3">Quick Actions</h3>
                    <div class="space-y-2">
                        <button @click="createReminder()" 
                                class="w-full flex items-center gap-2 px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                            <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            Create Reminder
                        </button>
                        
                        <button @click="addToCalendar()" 
                                class="w-full flex items-center gap-2 px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                            <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                            Add to Calendar
                        </button>
                        
                        <button @click="sendToDiscord()" 
                                class="w-full flex items-center gap-2 px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md">
                            <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
                            </svg>
                            Send to Discord
                        </button>
                    </div>
                </div>
                
                <!-- Related Notes -->
                <div x-show="relatedNotes.length > 0" class="bg-white rounded-lg border border-gray-200 p-4">
                    <h3 class="text-sm font-semibold text-gray-900 mb-3">Related Notes</h3>
                    <div class="space-y-3">
                        <template x-for="related in relatedNotes" :key="related.id">
                            <a :href="`/detail/${related.id}`" 
                               class="block p-3 rounded-md border border-gray-100 hover:bg-gray-50">
                                <div class="text-sm font-medium text-gray-900" x-text="related.title"></div>
                                <div class="text-xs text-gray-500 mt-1" x-text="formatDate(related.timestamp)"></div>
                            </a>
                        </template>
                    </div>
                </div>
                
                <!-- Note Stats -->
                <div class="bg-white rounded-lg border border-gray-200 p-4">
                    <h3 class="text-sm font-semibold text-gray-900 mb-3">Note Info</h3>
                    <dl class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <dt class="text-gray-500">Created</dt>
                            <dd class="text-gray-900" x-text="formatDate(note.timestamp)"></dd>
                        </div>
                        <div class="flex justify-between">
                            <dt class="text-gray-500">Word Count</dt>
                            <dd class="text-gray-900" x-text="wordCount"></dd>
                        </div>
                        <div class="flex justify-between">
                            <dt class="text-gray-500">Read Time</dt>
                            <dd class="text-gray-900" x-text="readTime + ' min'"></dd>
                        </div>
                    </dl>
                </div>
            </div>
        </div>
    </div>

    <script>
        function noteDetail() {
            return {
                showFullContent: false,
                audioPlaying: false,
                audioProgress: 0,
                audioTime: '0:00 / 3:45',
                
                // Mock note data - replace with API call
                note: {
                    id: 1,
                    title: 'Team Meeting - Q1 Planning Session',
                    summary: 'Discussed roadmap for Q1 including new user authentication system, API redesign, and mobile app development. Key decisions made about technology stack and timeline. Team alignment on priorities and resource allocation.',
                    content: `Meeting Notes - Q1 Planning Session
Date: January 12, 2025
Attendees: Dan, Sarah, Mike, Lisa

Key Discussion Points:
1. User Authentication System
   - Move to OAuth 2.0 implementation
   - Add social login options (Google, GitHub)
   - Timeline: 3 weeks

2. API Redesign
   - RESTful to GraphQL migration
   - Better error handling
   - Rate limiting implementation
   - Timeline: 4 weeks

3. Mobile App Development
   - React Native vs native development
   - Decided on React Native for faster development
   - MVP features defined
   - Timeline: 8 weeks

Budget Considerations:
- Additional developer needed for mobile
- Infrastructure scaling costs
- Third-party service integrations

Next Steps:
- Technical specification documents
- Resource planning meeting
- Stakeholder approval process`,
                    type: 'audio',
                    status: 'complete',
                    timestamp: '2025-01-12T14:30:00Z',
                    tags: ['meeting', 'planning', 'Q1', 'team', 'roadmap'],
                    actions: [
                        'Create technical specification for authentication system',
                        'Schedule resource planning meeting with HR',
                        'Get stakeholder approval for mobile app budget',
                        'Research React Native development team options'
                    ],
                    audioFilename: 'meeting-2025-01-12.wav'
                },
                
                relatedNotes: [
                    {
                        id: 2,
                        title: 'Authentication System Research',
                        timestamp: '2025-01-10T09:00:00Z'
                    },
                    {
                        id: 3,
                        title: 'Mobile App Wireframes',
                        timestamp: '2025-01-08T15:30:00Z'
                    },
                    {
                        id: 4,
                        title: 'Q4 Retrospective Notes',
                        timestamp: '2024-12-20T10:00:00Z'
                    }
                ],
                
                get wordCount() {
                    return this.note.content ? this.note.content.split(/\s+/).length : 0;
                },
                
                get readTime() {
                    return Math.ceil(this.wordCount / 200); // 200 words per minute
                },
                
                formatDateTime(timestamp) {
                    const date = new Date(timestamp);
                    return date.toLocaleString('en-US', {
                        weekday: 'long',
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                        hour: 'numeric',
                        minute: '2-digit'
                    });
                },
                
                formatDate(timestamp) {
                    const date = new Date(timestamp);
                    const now = new Date();
                    const diffTime = Math.abs(now - date);
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    
                    if (diffDays === 1) return 'Today';
                    if (diffDays === 2) return 'Yesterday';
                    if (diffDays <= 7) return `${diffDays} days ago`;
                    
                    return date.toLocaleDateString('en-US', {
                        month: 'short',
                        day: 'numeric',
                        year: 'numeric'
                    });
                },
                
                toggleEdit() {
                    window.location.href = `/edit/${this.note.id}`;
                },
                
                toggleAudio() {
                    this.audioPlaying = !this.audioPlaying;
                    // Implement actual audio playback
                },
                
                async exportToObsidian() {
                    try {
                        const response = await fetch('/sync/obsidian', { method: 'POST' });
                        if (response.ok) {
                            // Show success notification
                            console.log('Exported to Obsidian successfully');
                        }
                    } catch (error) {
                        console.error('Export failed:', error);
                    }
                },
                
                shareNote() {
                    if (navigator.share) {
                        navigator.share({
                            title: this.note.title,
                            text: this.note.summary,
                            url: window.location.href
                        });
                    } else {
                        // Fallback to clipboard
                        navigator.clipboard.writeText(window.location.href);
                        console.log('Link copied to clipboard');
                    }
                },
                
                deleteNote() {
                    if (confirm('Are you sure you want to delete this note?')) {
                        fetch(`/delete/${this.note.id}`, { method: 'POST' })
                            .then(() => window.location.href = '/');
                    }
                },
                
                createReminder() {
                    // Integrate with Apple Reminders or other reminder systems
                    console.log('Creating reminder...');
                },
                
                addToCalendar() {
                    // Create calendar event
                    console.log('Adding to calendar...');
                },
                
                sendToDiscord() {
                    // Send to Discord via webhook
                    console.log('Sending to Discord...');
                }
            }
        }
    </script>
</body>
</html>