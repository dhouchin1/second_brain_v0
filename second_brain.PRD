# Second Brain - Product Requirements Document (PRD)

## 1. Product Overview

### 1.1 Vision
Second Brain is an AI-powered note-taking and knowledge management platform that seamlessly captures, processes, and organizes personal information across multiple input channels. It serves as an intelligent intermediary layer between various data sources and knowledge management systems like Obsidian.

### 1.2 Mission
To create a frictionless digital memory system that automatically processes and contextualizes personal notes, audio recordings, web content, and communications into a searchable, actionable knowledge base.

### 1.3 Target Users
- Knowledge workers and content creators
- Researchers and students
- Professionals who attend frequent meetings
- Users of personal knowledge management systems (Obsidian, Notion, etc.)
- Apple ecosystem users leveraging shortcuts and voice dictation

## 2. Core Value Proposition

### 2.1 Key Benefits
- **Zero-friction capture**: Instant note-taking from any device or platform
- **AI-powered processing**: Automatic summarization, tagging, and action item extraction
- **Multi-modal input**: Text, audio, web content, and API integrations
- **Intelligent search**: FTS5-powered search with semantic understanding
- **Seamless integration**: Native Obsidian sync and Apple Shortcuts support
- **Real-time processing**: Background AI processing with status tracking

### 2.2 Differentiation
Unlike traditional note-taking apps, Second Brain focuses on intelligent preprocessing and routing rather than being a final destination for content. It acts as a smart capture and processing layer that enhances existing workflows.

## 3. Feature Requirements

### 3.1 Core Features (MVP)

#### 3.1.1 Quick Capture System
- **Text Capture**: Web-based quick note interface
- **Audio Capture**: File upload with automatic transcription via Whisper.cpp
- **Apple Shortcuts Integration**: iOS shortcuts for voice dictation and quick notes
- **Browser Extension**: One-click capture from web pages
- **Web Link Ingestion**: Intelligent web content extraction from pasted URLs
- **API Endpoints**: Webhook support for external integrations

#### 3.1.1.1 Web Content Ingestion (NEW)
- **URL Detection**: Automatic recognition of web links in Quick Notes text
- **Content Extraction**: Playwright-powered web scraping with JavaScript rendering
- **Rich Metadata Capture**: Page title, description, author, publish date extraction
- **Screenshot Capture**: Visual snapshots of web pages for context and reference
- **Content Processing**: AI-powered summarization and tagging of extracted web content
- **Smart Deduplication**: Intelligent handling of duplicate URLs and content

#### 3.1.2 AI Processing Pipeline
- **Automatic Transcription**: Whisper.cpp integration for audio-to-text
- **Content Summarization**: Ollama-powered summarization
- **Smart Tagging**: AI-generated tags based on content analysis
- **Action Item Extraction**: Automatic identification of tasks and follow-ups
- **Title Generation**: Intelligent title creation for captured content

#### 3.1.3 Search & Discovery
- **Full-Text Search**: SQLite FTS5 implementation with highlighting
- **Tag-based Filtering**: Dynamic tag filtering and discovery
- **Timeline View**: Chronological organization of notes by day
- **Related Content**: Automatic linking of related notes via tags
- **Advanced Filters**: Search by type, date range, and metadata

#### 3.1.4 Content Management
- **Rich Detail Views**: Full note display with metadata
- **In-place Editing**: Direct content and tag editing
- **Audio Playback**: Inline audio player for recordings
- **Batch Operations**: Multi-note tagging, deletion, and export
- **Status Tracking**: Real-time processing status updates

### 3.2 Integration Features

#### 3.2.1 Obsidian Sync
- **Markdown Export**: Automatic conversion to Obsidian-compatible format
- **Media Handling**: Audio file linking and organization
- **Metadata Preservation**: YAML frontmatter with tags and summaries
- **Incremental Sync**: Efficient sync of new and updated content

#### 3.2.2 External Platform Support
- **Discord Bot**: Server integration for team note-taking
- **Apple Shortcuts**: Deep iOS integration with widgets
- **Browser Extension**: Cross-platform web content capture
- **Webhook API**: Generic integration endpoint for automation

### 3.3 Advanced Features (Partially Implemented)

#### 3.3.1 Enhanced AI Capabilities
- âœ… **Semantic Search**: Vector embedding-based content discovery with hybrid FTS5 integration
- âœ… **Real-time Status Updates**: Server-Sent Events for processing status tracking
- ðŸ“‹ **Content Recommendations**: AI-powered content suggestions
- ðŸ“‹ **Meeting Intelligence**: Calendar integration with pre/post meeting notes
- ðŸ“‹ **Smart Templates**: Context-aware note templates

#### 3.3.2 Collaboration Features
- **Shared Notebooks**: Team-based note sharing
- **Comment System**: Collaborative annotation
- **Access Control**: Granular permission management
- **Activity Feeds**: Team activity tracking

#### 3.3.3 Analytics & Insights
- âœ… **Search Analytics**: Query performance tracking and search result analytics
- âœ… **Processing Status**: Real-time AI processing monitoring and queue management  
- ðŸ“‹ **Usage Analytics**: Personal productivity insights
- ðŸ“‹ **Content Metrics**: Note creation and engagement statistics
- ðŸ“‹ **AI Performance**: Processing accuracy and efficiency tracking

## 4. Technical Architecture

### 4.1 Technology Stack
- **Backend**: FastAPI (Python) with enhanced error handling and validation
- **Database**: SQLite with FTS5 for text search + optional sqlite-vec extension for semantic search
- **Real-time Communication**: Server-Sent Events (SSE) for status updates
- **AI Processing**: 
  - Ollama (local LLM inference with embedding generation)
  - Whisper.cpp (audio transcription)
  - Advanced Search Indexer (chunk-based FTS5 + vector hybrid search)
  - Reciprocal Rank Fusion (RRF) for optimal result ranking
- **Auto-Seeding Infrastructure**:
  - Intelligent content bootstrapping for new users
  - Configurable seed content sets (notes, bookmarks, examples)
  - Automatic embedding generation for seeded content
- **Web Content Extraction**: 
  - Playwright (browser automation and JavaScript rendering)
  - BeautifulSoup4 (HTML parsing and cleaning)
  - Readability-lxml (main content extraction)
  - html2text (HTML to markdown conversion)
- **Frontend**: Jinja2 templates with progressive enhancement and modern design system
- **Authentication**: JWT-based auth with bcrypt
- **File Storage**: Local filesystem with configurable paths and media handling
- **Screenshot Storage**: Optimized image storage with WebP format

### 4.2 Data Models

#### 4.2.1 Core Entities
```sql
notes (
  id, title, content, summary, tags, actions,
  type, timestamp, audio_filename, status,
  user_id, metadata, archive_path,
  source_url, web_metadata, screenshot_path,
  content_hash, extracted_text, file_metadata
)

users (
  id, username, hashed_password
)

search_analytics (
  id, user_id, query, results_count, 
  search_type, timestamp
)
```

#### 4.2.2 Full-Text Search
- FTS5 virtual table with porter stemming
- Content-aware snippet generation
- BM25 relevance scoring

### 4.3 API Design

#### 4.3.1 Core Endpoints
- `POST /capture` - Multi-modal content capture (enhanced with URL detection)
- `GET /` - Dashboard with search and filtering
- `GET /detail/{id}` - Individual note view
- `POST /api/search/fused` - Ultimate hybrid search with RRF and re-ranking
- `POST /api/search/reranked` - Cross-encoder re-ranking search
- `POST /api/search/sparse` - BM25 keyword search
- `POST /sync/obsidian` - Trigger export

#### 4.3.1.1 Web Content Endpoints (NEW)
- `POST /web-extract` - Manual web content extraction
- `GET /web-preview/{note_id}` - Preview extracted web content
- `GET /web-metadata/{url_hash}` - Cached web content metadata
- `GET /web-screenshot/{note_id}` - Serve captured screenshots

#### 4.3.2 Integration Endpoints
- `POST /webhook/apple` - Apple Shortcuts integration
- `POST /webhook/discord` - Discord bot webhook
- `POST /webhook/browser` - Browser extension capture
- `GET /api/analytics` - Usage statistics

### 4.4 Security & Privacy
- JWT-based authentication
- User-scoped data access
- HTTPS-only API endpoints
- Local-first data processing (no cloud AI dependencies)

## 5. User Experience Requirements

### 5.1 Design Principles
- **Minimal Friction**: Capture should require minimal user interaction
- **Progressive Enhancement**: Core functionality works without JavaScript
- **Responsive Design**: Optimized for mobile and desktop
- **Accessibility**: WCAG 2.1 compliance for screen readers and keyboards

### 5.2 User Flows

#### 5.2.1 Quick Capture Flow
1. User accesses capture interface (web, mobile, API)
2. System accepts input (text, audio, file)
3. Background AI processing begins
4. User receives immediate confirmation with processing status
5. Processed note appears in dashboard with AI enhancements

#### 5.2.2 Search & Discovery Flow
1. User enters search query or selects filters
2. System returns ranked results with highlights
3. User can refine search or access detailed views
4. Related content suggestions appear based on current context

### 5.3 Performance Requirements
- **Capture Response**: < 200ms for immediate feedback
- **AI Processing**: < 30s for audio transcription, < 10s for text processing
- **Search Response**: < 100ms for FTS queries
- **Page Load**: < 2s for dashboard with 100 notes

## 6. Quality & Testing Requirements

### 6.1 Testing Strategy
- Unit tests for core processing functions
- Integration tests for AI pipeline
- API endpoint testing for all webhooks
- End-to-end testing for critical user flows

### 6.2 Quality Metrics
- **AI Accuracy**: >90% transcription accuracy for clear audio
- **Search Relevance**: User satisfaction >85% for search results
- **System Uptime**: >99% availability during business hours
- **Data Integrity**: Zero data loss during processing pipeline

## 7. Implementation Roadmap

### 7.1 Phase 1: Core MVP (Current State)
- âœ… Basic capture and processing pipeline
- âœ… AI-powered summarization and tagging
- âœ… Full-text search with FTS5
- âœ… Obsidian export functionality
- âœ… Apple Shortcuts integration

### 7.2 Phase 2: Enhanced Integrations
- ðŸ”„ Browser extension deployment
- ðŸ”„ Discord bot improvements
- ðŸ”„ Enhanced mobile experience
- ðŸ”„ Batch operations interface

### 7.3 Phase 3: Advanced AI Features âœ… COMPLETED
- âœ… **Semantic Search**: Vector embeddings with hybrid FTS5 + sqlite-vec integration
- âœ… **Advanced Search Analytics**: Performance tracking and query analytics with real-time monitoring
- âœ… **Real-time Status Updates**: Server-Sent Events for processing status tracking
- âœ… **Auto-Seeding Service**: Intelligent new user onboarding with curated starter content
- âœ… **Advanced Search Indexer**: Chunk-based indexing with Reciprocal Rank Fusion (RRF)
- âœ… **Service Architecture**: Complete modular router system with comprehensive service layer
- âœ… **Search Performance**: Sub-100ms response times with BM25 + vector hybrid search
- ðŸ“‹ Content recommendation system (planned)
- ðŸ“‹ Meeting intelligence features (planned)

### 7.4 Phase 4: Collaboration & Scale
- ðŸ“‹ Multi-user support
- ðŸ“‹ Team collaboration features
- ðŸ“‹ Cloud deployment options
- ðŸ“‹ Performance optimization

## 8. Success Metrics

### 8.1 Adoption Metrics
- Daily/Monthly Active Users
- Notes created per user per day
- API endpoint usage frequency
- Integration adoption rates

### 8.2 Engagement Metrics
- Search queries per session
- Content export frequency
- Feature utilization rates
- User retention (weekly/monthly)

### 8.3 Quality Metrics
- AI processing accuracy rates
- Search result click-through rates
- User-reported processing errors
- System performance benchmarks

## 9. Risk Assessment

### 9.1 Technical Risks
- **AI Model Dependencies**: Ollama/Whisper availability and performance
- **Data Growth**: SQLite scalability with large content volumes
- **Processing Latency**: Real-time AI processing performance
- **Integration Complexity**: External API reliability

### 9.2 Mitigation Strategies
- Fallback processing modes for AI failures
- Database optimization and migration planning
- Asynchronous processing with status tracking
- Robust error handling for external integrations

## 10. Future Considerations

### 10.1 Scalability Planning
- Database migration strategy (SQLite â†’ PostgreSQL)
- Microservices architecture for AI processing
- CDN integration for media files
- Multi-tenant SaaS architecture

### 10.2 Technology Evolution
- Integration with newer AI models (GPT-4, Claude)
- Mobile app development (iOS/Android)
- Real-time collaboration features
- Blockchain integration for data ownership

---

**Document Version**: 1.3  
**Last Updated**: September 4, 2025  
**Status**: Phase 3 Complete - Auto-Seeding & Advanced Search Indexer Deployed  
**Next Review**: September 15, 2025  
**Major Milestones Achieved**: âœ… Auto-Seeding Service, âœ… Chunk-based Search Indexer, âœ… Hybrid RRF Search